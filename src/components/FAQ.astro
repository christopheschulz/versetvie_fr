---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const faqs = [
  { question: t('faq.q7'), answer: t('faq.a7') },
  { question: t('faq.q1'), answer: t('faq.a1') },
  { question: t('faq.q2'), answer: t('faq.a2') },
  { question: t('faq.q3'), answer: t('faq.a3') },
  { question: t('faq.q4'), answer: t('faq.a4') },
  { question: t('faq.q5'), answer: t('faq.a5') },
  { question: t('faq.q6'), answer: t('faq.a6') },
];
---

<section id="faq" class="py-20 px-4">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-3xl sm:text-4xl font-bold text-center mb-12">
      <span class="bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-secondary)] bg-clip-text text-transparent">
        {t('faq.title')}
      </span>
    </h2>

    <div class="faq-container space-y-4">
      {faqs.map((faq) => (
        <details class="faq-item rounded-xl bg-[var(--color-card)] border border-[var(--color-border)] overflow-hidden">
          <summary class="px-6 py-4 flex items-center justify-between font-medium hover:bg-[var(--color-background)]/50 transition-colors cursor-pointer list-none">
            <span>{faq.question}</span>
            <svg class="faq-icon w-5 h-5 text-[var(--color-text-tertiary)] transition-transform duration-300 ease-out flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </summary>
          <div class="faq-answer">
            <div class="faq-answer-inner px-6 pb-4">
              <p class="text-[var(--color-text-secondary)] leading-relaxed">{faq.answer}</p>
            </div>
          </div>
        </details>
      ))}
    </div>
  </div>
</section>

<style>
  /* Remove default marker */
  details summary::-webkit-details-marker {
    display: none;
  }

  /* Icon rotation */
  .faq-icon {
    transition: transform 0.3s ease-out;
  }

  details[open] .faq-icon,
  details.closing .faq-icon {
    transform: rotate(180deg);
  }

  details.closing .faq-icon {
    transform: rotate(0deg);
  }

  /* Animate answer with CSS Grid */
  .faq-answer {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    transition: grid-template-rows 0.3s ease-out, opacity 0.2s ease-out;
  }

  details[open] .faq-answer {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  /* Closing state: animate back to closed */
  details.closing .faq-answer {
    grid-template-rows: 0fr;
    opacity: 0;
  }

  .faq-answer-inner {
    overflow: hidden;
  }
</style>

<script>
  function initFAQ() {
    const container = document.querySelector('.faq-container');
    if (!container) return;

    const allDetails = container.querySelectorAll('details');
    const ANIMATION_DURATION = 300;

    allDetails.forEach(details => {
      const summary = details.querySelector('summary');
      if (!summary) return;

      summary.addEventListener('click', (e) => {
        e.preventDefault();

        if (details.open) {
          // Closing: add class, wait for animation, then close
          details.classList.add('closing');
          setTimeout(() => {
            details.open = false;
            details.classList.remove('closing');
          }, ANIMATION_DURATION);
        } else {
          // Opening: close others first (with animation), then open this one
          allDetails.forEach(other => {
            if (other !== details && other.open) {
              other.classList.add('closing');
              setTimeout(() => {
                other.open = false;
                other.classList.remove('closing');
              }, ANIMATION_DURATION);
            }
          });
          details.open = true;
        }
      });
    });
  }

  document.addEventListener('DOMContentLoaded', initFAQ);
  document.addEventListener('astro:page-load', initFAQ);
</script>
