---
import { getLangFromUrl, useTranslations, getLocalePrefix, storeUrls, storeBadges } from '../i18n/utils';
import type { Lang } from '../i18n/ui';

const lang = getLangFromUrl(Astro.url) as Lang;
const t = useTranslations(lang);
const prefix = getLocalePrefix(lang);
const home = prefix ? `${prefix}/` : '/';

const currentYear = new Date().getFullYear();

// Localized paths for legal pages
const legalPaths = {
  fr: { privacy: '/confidentialite', terms: '/conditions', legalNotice: '/mentions-legales' },
  en: { privacy: '/en/privacy', terms: '/en/terms', legalNotice: '/en/legal-notice' },
  de: { privacy: '/de/datenschutz', terms: '/de/nutzungsbedingungen', legalNotice: '/de/impressum' },
};
const paths = legalPaths[lang as keyof typeof legalPaths];

const badges = storeBadges[lang];
---

<footer class="py-16 px-4 border-t border-[var(--color-border)] bg-[var(--color-surface)]/30">
  <div class="max-w-6xl mx-auto">
    <!-- Main Footer Content -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10 mb-12">

      <!-- Brand Column -->
      <div class="lg:col-span-1 text-center md:text-left">
        <a href={home} class="inline-flex items-center gap-3 mb-4">
          <img src="/icon.png" alt="VersetVie" class="w-12 h-12 rounded-xl" />
          <span class="font-bold text-xl">VersetVie</span>
        </a>
        <p class="text-sm text-[var(--color-text-secondary)] mb-6 leading-relaxed">
          {t('footer.description')}
        </p>
        <!-- Contact Email -->
        <a
          href="mailto:contact@codebykriss.fr"
          class="inline-flex items-center gap-2 text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          contact@codebykriss.fr
        </a>
      </div>

      <!-- Navigation Column -->
      <div class="text-center md:text-left">
        <h3 class="font-semibold text-sm uppercase tracking-wider mb-4 text-[var(--color-text-tertiary)]">
          {t('footer.navigation')}
        </h3>
        <nav class="flex flex-col gap-3 items-center md:items-start">
          <a href={home} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            {t('nav.home')}
          </a>
          <a href={`${prefix}/#screenshots`} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            {t('nav.screenshots')}
          </a>
          <a href={`${prefix}/#features`} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            {t('nav.features')}
          </a>
          <a href={`${prefix}/#testimonials`} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            {t('nav.testimonials')}
          </a>
          <a href={`${prefix}/#faq`} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            FAQ
          </a>
        </nav>
      </div>

      <!-- Legal Column -->
      <div class="text-center md:text-left">
        <h3 class="font-semibold text-sm uppercase tracking-wider mb-4 text-[var(--color-text-tertiary)]">
          {t('footer.legal')}
        </h3>
        <nav class="flex flex-col gap-3 items-center md:items-start">
          <a href={paths.privacy} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            {t('footer.privacy')}
          </a>
          <a href={paths.terms} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            {t('footer.terms')}
          </a>
          <a href={paths.legalNotice} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            {t('footer.legalNotice')}
          </a>
          <a href={lang === 'de' ? `${prefix}/kontakt` : `${prefix}/contact`} class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] transition-colors">
            {t('footer.contact')}
          </a>
        </nav>
      </div>

      <!-- Download Column (CTA) -->
      <div class="text-center md:text-left">
        <h3 class="font-semibold text-sm uppercase tracking-wider mb-4 text-[var(--color-text-tertiary)]">
          {t('footer.download')}
        </h3>
        <div class="flex flex-col gap-3 items-center md:items-start">
          <a
            href={storeUrls.appStore}
            target="_blank"
            rel="noopener noreferrer"
            class="transition-transform hover:scale-105"
          >
            <img
              src={badges.appStore}
              alt="App Store"
              class="h-10 w-auto"
              loading="lazy"
            />
          </a>
          <a
            href={storeUrls.googlePlay}
            target="_blank"
            rel="noopener noreferrer"
            class="transition-transform hover:scale-105"
          >
            <img
              src={badges.googlePlay}
              alt="Google Play"
              class="h-10 w-auto"
              loading="lazy"
            />
          </a>
        </div>
      </div>
    </div>

    <!-- Bottom Bar -->
    <div class="pt-8 border-t border-[var(--color-border)]">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <!-- Copyright -->
        <p class="text-sm text-[var(--color-text-tertiary)] text-center md:text-left">
          &copy; {currentYear} VersetVie. {t('footer.rights')}
        </p>

        <!-- Made By -->
        <p class="text-sm text-[var(--color-text-tertiary)]">
          {t('footer.madeBy')} <a href="https://codebykriss.fr" target="_blank" rel="noopener" class="text-[var(--color-primary)] hover:underline font-medium">Code By Kriss</a>
        </p>
      </div>
    </div>
  </div>
</footer>
